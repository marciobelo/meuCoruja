<!DOCTYPE html>
<html>
    <head>

        <link rel="manifest" href="manifest.json">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <meta http-equiv="Content-Type" content="text/html; charset=windows-1252" />
        <title>Boletim</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <link rel="stylesheet" type="text/css" href="css/tabela.css">
        <link rel="stylesheet" type="text/css" href="css/estilo.css">

        <script>

            function abrirDetalhamentoFaltas(id) {
                id = $(id).closest('tr').index();
                sessionStorage.setItem('idDetalhamentoFaltas', id);
                window.location = "detalhamentoFaltas.html";
            }

            $(document).ready(function () {
                jQuery(document).ready(adicionarSideBar);

                function adicionarSideBar() {
                    $.get("sidebar.html", function (sidebar) {
                        $('body').prepend(sidebar);
                    });
                }
            });

            $(document).ready(function () {
                boletim = JSON.parse(localStorage.getItem('meuCoruja')).boletim;
                controle = JSON.parse(localStorage.getItem('meuCoruja')).controle;
                console.log(controle);
                console.log(boletim.disciplinas.length);
                
                $('thead tr').append( $('<th />', {text : 'Disciplina'}));
                for(i = 0; i < controle.ItensCriterioAvaliacao.length-1; i++){
                    $('thead tr').append( $('<th />', {text : controle.ItensCriterioAvaliacao[i].rotulo}));
                }
                $('thead tr').append( $('<th />', {text : 'Professor'}));
                $('thead tr').append( $('<th />', {text : 'Faltas'}));
                
                
                for (i = 0; i < boletim.disciplinas.length; i++) {

                    console.log(siglaDisciplina = boletim.disciplinas[i].info.siglaDisciplina);
                    nomeDisciplina = boletim.disciplinas[i].info.nomeDisciplina;
                    professor = boletim.disciplinas[i].info.nomeProfessor;
                    emailProfessor = boletim.disciplinas[i].info.emailProfessor;
                    console.log(emailProfessor);
                    faltas = boletim.disciplinas[i].info.faltas;
                    limiteFaltas = boletim.disciplinas[i].info.limiteFaltas;
                    //avaliacoes

                    av1 = boletim.disciplinas[i].avaliacoes[0].nota;
                    av2 = boletim.disciplinas[i].avaliacoes[1].nota;
                    media = boletim.disciplinas[i].avaliacoes[2].nota;
                    avf = boletim.disciplinas[i].avaliacoes[3].nota;
                    mediaFinal = boletim.disciplinas[i].avaliacoes[4].nota;

                    $("#boletim").find('tbody')
                            .append(($('<tr>'))
                                    .append($("<td data-label='Disciplina'>" + siglaDisciplina + "</td>"))
                                    .append($("<td data-label='AV1'>" + av1 + "</td>"))
                                    .append($("<td data-label='AV2'>" + av2 + "</td>"))
                                    .append($("<td data-label='Média'>" + media + "</td>"))
                                    .append($("<td data-label='AVF'>" + avf + "</td>"))
                                    .append($("<td data-label='Média Final'>" + mediaFinal + "</td>"))
                                    .append($("<td data-label='Professor'><a href='mailto:" + emailProfessor + "'>" + professor + "</td>"))
                                    .append($("<td data-label='Faltas'>\n\
                                            <span>" + faltas + "</span> / \n\
                                            <span> " + limiteFaltas + "</span>&nbsp"
                                            + "<a onclick='abrirDetalhamentoFaltas(this)'>\n\
                                                    <span class='glyphicon glyphicon-zoom-in' aria-hidden='true'>\n\
                                                    </span>\n\
                                                </a>\n\
                                        </td>"))
                                    );



                }
                periodoLetivo = boletim.siglaPeriodoLetivo;
                document.getElementById("siglaPeriodoLetivo").innerHTML = periodoLetivo;


            });
        </script>




    </head>
    <body class="link1">

        <div class="site-wrap">

            <h1>Boletim</h1>
            <div><h2 id="siglaPeriodoLetivo" align="center"></h2></div>
            <table id="boletim">
                <thead id="theadBoletim">
                    <tr>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        
    </body>
</html>