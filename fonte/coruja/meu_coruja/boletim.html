<!DOCTYPE html>
<html>
    <head>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="Content-Type" content="text/html; charset=windows-1252" />
        <title>Boletim</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <link rel="stylesheet" type="text/css" href="css/tabela.css">
        <link rel="stylesheet" type="text/css" href="css/estilo.css">

        <script>
            $(document).ready(function () {
                jQuery(document).ready(adicionarSideBar);

                function adicionarSideBar() {
                    $.get("sidebar.html", function (sidebar) {
                        $('body').prepend(sidebar);
                    });
                }
            });
            
            $(document).ready(function () {
                $.ajax({url: "endpoint_meucoruja.php",
                    success: function (result, status, jqXHR) {
                        meuCoruja = JSON.parse(result);
                        localStorage.setItem("meuCoruja", JSON.stringify(meuCoruja));
                        boletim = JSON.parse(localStorage.getItem('meuCoruja'))[1];
                        //console.log(JSON.parse(localStorage.getItem('meuCoruja'))[1][0][0].nomeDisciplina);
                        //console.log(JSON.parse(localStorage.getItem('meuCoruja'))[1].length);

                        for (var i = 0; i < JSON.parse(localStorage.getItem('meuCoruja'))[1].length; i++) {

                            siglaDisciplina = boletim[i][0].siglaDisciplina;
                            nomeDisciplina = boletim[i][0].nomeDisciplina;
                            professor = boletim[i][0].nomeProfessor;
                            faltas = boletim[i][0].faltas;
                            limiteFaltas = boletim[i][0].limiteFaltas;
                            //avaliacoes
                            av1 = boletim[i][1][0].nota;
                            av2 = boletim[i][1][1].nota;
                            media = boletim[i][1][2].nota;
                            avf = boletim[i][1][3].nota;
                            mediaFinal = boletim[i][1][4].nota;
                            $("#boletim").find('tbody')
                                    .append(($('<tr>'))
                                            .append($("<td data-label='Disciplina' data-tooltip='" + nomeDisciplina + "'>" + siglaDisciplina + "</td>"))
                                            .append($("<td data-label='AV1'>" + av1 + "</td>"))
                                            .append($("<td data-label='AV2'>" + av2 + "</td>"))
                                            .append($("<td data-label='Média'>" + media + "</td>"))
                                            .append($("<td data-label='AVF'>" + avf + "</td>"))
                                            .append($("<td data-label='Média Final'>" + mediaFinal + "</td>"))
                                            .append($("<td data-label='Professor'>" + professor + "</td>"))
                                            .append($("<td data-label='Faltas'><span>" + faltas + "</span> /<span> " + limiteFaltas + "</span><a href= 'detalhamentoFaltas.html'><input type='image'  class='informacao' src='img/information-circular-button.png'></a></td>"))
                                            );
                            var periodoLetivo = JSON.parse(localStorage.getItem('meuCoruja'))[1][i][0].siglaPeriodoLetivo;
                        }
                        document.getElementById("siglaPeriodoLetivo").innerHTML = periodoLetivo;

                        //sidebar
                        sidebar = JSON.parse(localStorage.getItem('meuCoruja'))[0];
                        console.log(sidebar);
                        usuario = JSON.parse(localStorage.getItem('meuCoruja'))[0];

                        document.getElementById("nomeUsuario").innerHTML = usuario.nomeUsuario;
                        document.getElementById("curso").innerHTML = usuario.nomeCurso;
                        document.getElementById("matricula").innerHTML = usuario.matricula;
                    }});
            });
        </script>




    </head>
    <body class="link1">
        
        <div class="site-wrap">

            <h1>Boletim</h1>
            <div><h2 id="siglaPeriodoLetivo" align="center"></h2></div>
            <table id="boletim">
                <thead>
                    <tr>
                        <th>Disciplina</th>
                        <th>AV1</th>
                        <th>AV2</th>
                        <th>Média</th>
                        <th>AVF</th>
                        <th>Média Final</th>
                        <th>Professor</th>
                        <th>Faltas</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
        <!-- Modal -->
        <div id="myModal" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Detalhamento de faltas</h4>
                    </div>
                    <div class="modal-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Quantidade</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td data-label="Data">03/04/17</td>
                                    <td data-label="Quantidade">3</td>
                                </tr>
                                <tr>
                                    <td data-label="Data">15/05/17</td>
                                    <td data-label="Quantidade">6</td>
                                </tr>
                                <tr>
                                    <td data-label="Data">17/05/17</td>
                                    <td data-label="Quantidade">3</td>
                                </tr>

                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
                    </div>
                </div>

            </div>
        </div>

    </body>
</html>