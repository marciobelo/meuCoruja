<html>
    <head>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="Content-Type" content="text/html; charset=windows-1252" />
        <title>Histórico</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <link rel="stylesheet" type="text/css" href="css/tabela.css">
        <link rel="stylesheet" type="text/css" href="css/estilo.css">
        <script>
            $(document).ready(function () {
                jQuery(document).ready(adicionarSideBar);

                function adicionarSideBar() {
                    $.get("sidebar.html", function (sidebar) {
                        $('body').prepend(sidebar);
                    });
                }
            });




            $(document).ready(function () {
                $.ajax({url: "endpoint_historico.php",
                    success: function (result, status, jqXHR) {
                        console.log(jqXHR.status);
                        historico = JSON.parse(result);
                        console.log(historico);



                        for (var i = 0; i < historico.length; i++) {
                            $("#historico").find('tbody')
                                    .append(($('<tr>'))
                                            .append($("<td data-label='Disciplina' id='linha" + [i] + ".nome'>" + historico[i].siglaDisciplina + "</td>"))
                                            .append($("<td data-label='Média Final'>" + historico[i].mediaFinal + "</td>"))
                                            .append($("<td data-label='Faltas'>" + historico[i].faltas + "</td>"))
                                            .append($("<td data-label='Situação'>" + historico[i].situacao + "</td>"))
                                            .append($("<td data-label='Período Letivo'>" + historico[i].siglaPeriodoLetivo + "</td>"))
                                            );


                            function exibeCR() {
                                document.getElementById("cr").innerHTML = "CR: " + parseFloat(historico[i].cr);
                            }
                            exibeCR();


                        }
                            cacheHistorico =historico;
                            localStorage.setItem("meuCoruja.Historico", JSON.stringify(cacheHistorico));

                    }, error: function (jqXHR) {
                        //console.log(jqXHR.status);
                        if (jqXHR.status === 401) {
                            window.open("index.html", "_self");
                        } else if (localStorage.nomeUsuario !== null) {
                            for (var i = 0; i < localStorage.length; i++) {
                                $("#linha[" + [i] + "].nome").html(localStorage.getItem("linha[" + [i] + "].nome"));
                                //console.log("#linha"+[i]+".nome");
                                //console.log(localStorage.getItem("linha[0].nome"));
                            }
                        } else {
                            console.log("Erro ao obter dados do localStorage");
                        }
                    }});
            });


        </script>
    </head>
    <body class="link3">

        <div class="site-wrap">
            <h1 class="titulo-pagina">Histórico</h1>
            <h2 class="cr" id="cr">CR:</h2>

            <table  id="historico">
                <thead>
                    <tr>
                        <th>Disciplina</th>
                        <th>Nota</th>
                        <th>Faltas</th>
                        <th>Situação</th>
                        <th>Período Letivo</th>
                    </tr>
                </thead>
                <tbody>

                </tbody>
            </table>

        </div>

    </body>
</html>


